Installation
============

To begin, add the dependent bundles to the vendor/bundles directory. Add the following lines to the file deps::

    php composer.phar require sonata-project/cache-bundle

Now, add the new Bundle to the kernel

.. code-block:: php

    <?php
    public function registerbundles()
    {
        return array(
            // Vendor specifics bundles
            new Sonata\CacheBundle\SonataCacheBundle(),
        );
    }

Update the ``autoload.php`` to add new namespaces:

.. code-block:: php

    <?php
    $loader->registerNamespaces(array(
        'Sonata'                             => __DIR__,

        // ... other declarations
    ));


Configuration
-------------

To use the ``CacheBundle``, add the following lines to your application configuration
file.

.. code-block:: yaml

    # app/config/config.yml
    sonata_cache:
        caches:
            esi:
                token: an unique security key # a random one is generated by default
                servers:
                    - varnishadm -T 127.0.0.1:2000 {{ COMMAND }} "{{ EXPRESSION }}"

            ssi:
                token: an unique security key # a random one is generated by default
                servers:
                    - varnishadm -T 127.0.0.1:2000 {{ COMMAND }} "{{ EXPRESSION }}"

            mongo:
                database:   cache
                collection: cache
                servers:
                    - {host: 127.0.0.1, port: 27017, user: username, password: pASS'}
                    - {host: 127.0.0.2}

            memcached:
                prefix: test     # prefix to ensure there is no clash between instances
                servers:
                    - {host: 127.0.0.1, port: 11211, weight: 0}

            apc:
                token:  s3cur3   # token used to clear the related cache
                prefix: test     # prefix to ensure there is no clash between instances
                servers:
                    - { domain: kooqit.local, ip: 127.0.0.1, port: 80}

For APC you can specify a basic parameter for servers definition (useful to clear cache for staging area behind this kind of protection)

.. code-block:: yaml
    apc:
        token:  s3cur3   # token used to clear the related cache
        prefix: test     # prefix to ensure there is no clash between instances
        servers:
            - { domain: kooqit.local, ip: 127.0.0.1, port: 80, basic: 'user:login' }

At the end of your routing file, add the following lines

.. code-block:: yaml

    # app/config/routing.yml
    sonata_page_cache:
        resource: '@SonataCacheBundle/Resources/config/routing/cache.xml'
        prefix: /
